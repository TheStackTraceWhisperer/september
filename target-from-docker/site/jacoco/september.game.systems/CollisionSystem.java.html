<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CollisionSystem.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">september</a> &gt; <a href="index.source.html" class="el_package">september.game.systems</a> &gt; <span class="el_source">CollisionSystem.java</span></div><h1>CollisionSystem.java</h1><pre class="source lang-java linenums">package september.game.systems;

import september.engine.ecs.ISystem;
import september.engine.ecs.IWorld;
import september.engine.ecs.components.ColliderComponent;
import september.engine.ecs.components.TransformComponent;
import september.game.components.GameColliderType;

import java.util.List;

public class CollisionSystem implements ISystem {

    private final IWorld world;

<span class="nc" id="L15">    public CollisionSystem(IWorld world) {</span>
<span class="nc" id="L16">        this.world = world;</span>
<span class="nc" id="L17">    }</span>

    @Override
    public void update(float delta) {
<span class="nc" id="L21">        List&lt;Integer&gt; entities = world.getEntitiesWith(TransformComponent.class, ColliderComponent.class);</span>

<span class="nc bnc" id="L23" title="All 2 branches missed.">        for (int i = 0; i &lt; entities.size(); i++) {</span>
<span class="nc bnc" id="L24" title="All 2 branches missed.">            for (int j = i + 1; j &lt; entities.size(); j++) {</span>
<span class="nc" id="L25">                int entityA = entities.get(i);</span>
<span class="nc" id="L26">                int entityB = entities.get(j);</span>

<span class="nc" id="L28">                TransformComponent transformA = world.getComponent(entityA, TransformComponent.class);</span>
<span class="nc" id="L29">                ColliderComponent colliderA = world.getComponent(entityA, ColliderComponent.class);</span>

<span class="nc" id="L31">                TransformComponent transformB = world.getComponent(entityB, TransformComponent.class);</span>
<span class="nc" id="L32">                ColliderComponent colliderB = world.getComponent(entityB, ColliderComponent.class);</span>

<span class="nc bnc" id="L34" title="All 2 branches missed.">                if (checkCollision(transformA, colliderA, transformB, colliderB)) {</span>
<span class="nc" id="L35">                    handleCollision(transformA, colliderA, transformB, colliderB);</span>
                }
            }
        }
<span class="nc" id="L39">    }</span>

    private void handleCollision(TransformComponent transformA, ColliderComponent colliderA, TransformComponent transformB, ColliderComponent colliderB) {
<span class="nc" id="L42">        ColliderComponent.ColliderType typeA = colliderA.getType();</span>
<span class="nc" id="L43">        ColliderComponent.ColliderType typeB = colliderB.getType();</span>

        // --- Player vs. Wall Collision ---
        // This is the core of our solid-object collision response.
        // We now compare against the concrete GameColliderType enum.
<span class="nc bnc" id="L48" title="All 4 branches missed.">        if (typeA == GameColliderType.PLAYER &amp;&amp; typeB == GameColliderType.WALL) {</span>
<span class="nc" id="L49">            transformA.revertPosition();</span>
<span class="nc bnc" id="L50" title="All 4 branches missed.">        } else if (typeB == GameColliderType.PLAYER &amp;&amp; typeA == GameColliderType.WALL) {</span>
<span class="nc" id="L51">            transformB.revertPosition();</span>
        }

        // Future collision types (e.g., PLAYER vs. ENEMY) can be added here.
<span class="nc" id="L55">    }</span>

    private boolean checkCollision(TransformComponent transformA, ColliderComponent colliderA, TransformComponent transformB, ColliderComponent colliderB) {
        // Get integer-based positions for the collision check
<span class="nc" id="L59">        int x1 = (int) (transformA.position.x + colliderA.getOffsetX());</span>
<span class="nc" id="L60">        int y1 = (int) (transformA.position.y + colliderA.getOffsetY());</span>
<span class="nc" id="L61">        int w1 = colliderA.getWidth();</span>
<span class="nc" id="L62">        int h1 = colliderA.getHeight();</span>

<span class="nc" id="L64">        int x2 = (int) (transformB.position.x + colliderB.getOffsetX());</span>
<span class="nc" id="L65">        int y2 = (int) (transformB.position.y + colliderB.getOffsetY());</span>
<span class="nc" id="L66">        int w2 = colliderB.getWidth();</span>
<span class="nc" id="L67">        int h2 = colliderB.getHeight();</span>

        // AABB collision check
<span class="nc bnc" id="L70" title="All 8 branches missed.">        return (x1 &lt; x2 + w2 &amp;&amp; x1 + w1 &gt; x2 &amp;&amp; y1 &lt; y2 + h2 &amp;&amp; y1 + h1 &gt; y2);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>