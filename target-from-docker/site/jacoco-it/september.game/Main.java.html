<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Main.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">september</a> &gt; <a href="index.source.html" class="el_package">september.game</a> &gt; <span class="el_source">Main.java</span></div><h1>Main.java</h1><pre class="source lang-java linenums">package september.game;

import org.joml.Vector3f;
import september.engine.assets.ResourceManager;
import september.engine.core.Engine;
import september.engine.core.MainLoopPolicy;
import september.engine.core.SystemTimer;
import september.engine.core.TimeService;
import september.engine.core.input.GlfwInputService;
import september.engine.core.input.InputService;
import september.engine.ecs.ISystem;
import september.engine.ecs.IWorld;
import september.engine.ecs.World;
import september.engine.ecs.components.ControllableComponent;
import september.engine.ecs.components.MovementStatsComponent;
import september.engine.ecs.components.SpriteComponent;
import september.engine.ecs.components.TransformComponent;
import september.engine.rendering.Camera;
import september.engine.systems.MovementSystem;
import september.game.components.EnemyComponent;
import september.game.components.PlayerComponent;
import september.game.input.InputMappingService;
import september.game.input.KeyboardMappingService;
import september.game.systems.EnemyAISystem;
import september.game.systems.PlayerInputSystem;

/**
 * The entry point for the game application.
 *
 * This class is the &quot;wiring root&quot; or &quot;composition root&quot;. Its only responsibility
 * is to instantiate all the necessary services, configure the initial game state
 * (entities and components), and then create and run the main Engine instance.
 */
public final class Main implements Runnable {
  private final MainLoopPolicy loopPolicy;

  public Main() {
<span class="nc" id="L38">    this(MainLoopPolicy.standard());</span>
<span class="nc" id="L39">  }</span>

<span class="fc" id="L41">  public Main(MainLoopPolicy loopPolicy) {</span>
<span class="fc" id="L42">    this.loopPolicy = loopPolicy;</span>
<span class="fc" id="L43">  }</span>

  @Override
  public void run() {
    // --- 1. Create Context-Independent Services and Configuration ---
<span class="fc" id="L48">    TimeService timeService = new SystemTimer();</span>
<span class="fc" id="L49">    IWorld world = new World();</span>
<span class="fc" id="L50">    ResourceManager resourceManager = new ResourceManager();</span>
<span class="fc" id="L51">    InputService inputService = new GlfwInputService();</span>
<span class="fc" id="L52">    InputMappingService mappingService = new KeyboardMappingService(inputService);</span>

<span class="fc" id="L54">    final float VIRTUAL_WIDTH = 800.0f;</span>
<span class="fc" id="L55">    final float VIRTUAL_HEIGHT = 600.0f;</span>
<span class="fc" id="L56">    Camera camera = new Camera(VIRTUAL_WIDTH, VIRTUAL_HEIGHT);</span>


    // --- CAMERA CONFIGURATION ---
    // Move the camera 5 units &quot;out of the screen&quot; to look at the origin.
<span class="fc" id="L61">    camera.setPosition(new Vector3f(0.0f, 0.0f, 5.0f));</span>

    // Set up the perspective projection.
    // This defines a 45-degree field of view, an aspect ratio for an 800x600 window,
    // and a view distance from 0.1 to 100 units.
<span class="fc" id="L66">    camera.setPerspective(45.0f, 800.0f / 600.0f, 0.1f, 100.0f);</span>


    // --- 2. Load Game Assets ---
    // NOTE: This call has been MOVED into the Engine class.
    // We cannot load textures here because there is no OpenGL context yet.
    // resourceManager.loadTexture(&quot;player_texture&quot;, &quot;textures/player.png&quot;);

    // --- 3. Define Initial Game State ---
<span class="fc" id="L75">    int playerEntity = world.createEntity();</span>
<span class="fc" id="L76">    world.addComponent(playerEntity, new TransformComponent());</span>
    // We still define WHAT sprite to use, but the loading happens later.
<span class="fc" id="L78">    world.addComponent(playerEntity, new SpriteComponent(&quot;player_texture&quot;));</span>
<span class="fc" id="L79">    world.addComponent(playerEntity, new ControllableComponent());</span>
<span class="fc" id="L80">    world.addComponent(playerEntity, new MovementStatsComponent(2.5f));</span>
<span class="fc" id="L81">    world.addComponent(playerEntity, new PlayerComponent()); // Tag the entity as the player</span>

<span class="fc" id="L83">    int enemyEntity = world.createEntity();</span>
<span class="fc" id="L84">    world.addComponent(enemyEntity, new TransformComponent());</span>
<span class="fc" id="L85">    world.addComponent(enemyEntity, new SpriteComponent(&quot;enemy_texture&quot;));</span>
<span class="fc" id="L86">    world.addComponent(enemyEntity, new MovementStatsComponent(2.5f));</span>
<span class="fc" id="L87">    world.addComponent(enemyEntity, new EnemyComponent());</span>

    // --- 4. Create Systems ---
    // The order is important: input should be processed before movement.
<span class="fc" id="L91">    ISystem playerInputSystem = new PlayerInputSystem(world, mappingService);</span>
<span class="fc" id="L92">    ISystem movementSystem = new MovementSystem(world);</span>
<span class="fc" id="L93">    ISystem enemyAISystem = new EnemyAISystem(world, timeService);</span>

    // --- 5. Create and Run the Engine ---
<span class="fc" id="L96">    Engine gameEngine = new Engine(world, timeService, resourceManager, camera, inputService, loopPolicy, playerInputSystem, movementSystem, enemyAISystem);</span>

    try {
<span class="fc" id="L99">      gameEngine.run();</span>
<span class="nc" id="L100">    } catch (Exception e) {</span>
<span class="nc" id="L101">      System.err.println(&quot;A fatal error occurred in the engine.&quot;);</span>
<span class="nc" id="L102">      e.printStackTrace();</span>
<span class="fc" id="L103">    }</span>
<span class="fc" id="L104">  }</span>

  public static void main(String[] args) {
<span class="nc" id="L107">    new Main().run();</span>
<span class="nc" id="L108">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>