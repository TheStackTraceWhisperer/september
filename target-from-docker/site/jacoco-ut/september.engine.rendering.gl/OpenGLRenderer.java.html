<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>OpenGLRenderer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">september</a> &gt; <a href="index.source.html" class="el_package">september.engine.rendering.gl</a> &gt; <span class="el_source">OpenGLRenderer.java</span></div><h1>OpenGLRenderer.java</h1><pre class="source lang-java linenums">package september.engine.rendering.gl;

import org.joml.Matrix4f;
import september.engine.rendering.Camera;
import september.engine.rendering.Mesh;
import september.engine.rendering.Renderer;
import september.engine.rendering.Texture;

import static org.lwjgl.opengl.GL11.*;
import static org.lwjgl.opengl.GL30.glBindVertexArray;

/**
 * A concrete implementation of the Renderer interface using OpenGL.
 * This implementation includes a default shader for rendering 2D textured sprites.
 */
public final class OpenGLRenderer implements Renderer {

  private static final String DEFAULT_VERTEX_SHADER_SOURCE =
    &quot;#version 460 core\n&quot; +
      &quot;layout (location = 0) in vec3 aPos;\n&quot; +
      &quot;layout (location = 1) in vec2 aTexCoord;\n&quot; +
      &quot;out vec2 vTexCoord;\n&quot; +
      &quot;uniform mat4 uProjection;\n&quot; +
      &quot;uniform mat4 uView;\n&quot; +
      &quot;uniform mat4 uModel;\n&quot; +
      &quot;void main()\n&quot; +
      &quot;{\n&quot; +
      &quot;    gl_Position = uProjection * uView * uModel * vec4(aPos, 1.0);\n&quot; +
      &quot;    vTexCoord = aTexCoord;\n&quot; +
      &quot;}&quot;;

  private static final String DEFAULT_FRAGMENT_SHADER_SOURCE =
    &quot;#version 460 core\n&quot; +
      &quot;out vec4 FragColor;\n&quot; +
      &quot;in vec2 vTexCoord;\n&quot; +
      &quot;uniform sampler2D uTextureSampler;\n&quot; +
      &quot;void main()\n&quot; +
      &quot;{\n&quot; +
      &quot;    FragColor = texture(uTextureSampler, vTexCoord);\n&quot; +
      &quot;}&quot;;

  private final Shader defaultShader;

<span class="fc" id="L44">  public OpenGLRenderer() {</span>
    // Create the default shader program for sprite rendering.
    // In a more advanced engine, this would be loaded from files by the ResourceManager.
<span class="fc" id="L47">    this.defaultShader = new Shader(DEFAULT_VERTEX_SHADER_SOURCE, DEFAULT_FRAGMENT_SHADER_SOURCE);</span>
<span class="fc" id="L48">  }</span>

  @Override
  public void beginScene(Camera camera) {
    // Clear the screen to a dark grey color
<span class="nc" id="L53">    glClearColor(0.1f, 0.1f, 0.1f, 1.0f);</span>
<span class="nc" id="L54">    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span>

    // Prepare the shader for the scene by binding it and setting the camera matrices
<span class="nc" id="L57">    defaultShader.bind();</span>
<span class="nc" id="L58">    defaultShader.setUniform(&quot;uProjection&quot;, camera.getProjectionMatrix());</span>
<span class="nc" id="L59">    defaultShader.setUniform(&quot;uView&quot;, camera.getViewMatrix());</span>
<span class="nc" id="L60">  }</span>

  @Override
  public void submit(Mesh mesh, Texture texture, Matrix4f transform) {
    // Bind the specific texture for this sprite to texture unit 0
<span class="nc" id="L65">    texture.bind(0);</span>
<span class="nc" id="L66">    defaultShader.setUniform(&quot;uTextureSampler&quot;, 0); // Tell the shader to use texture unit 0</span>

    // Set the model matrix for this specific object
<span class="nc" id="L69">    defaultShader.setUniform(&quot;uModel&quot;, transform);</span>

    // Bind the mesh's VAO
<span class="nc" id="L72">    glBindVertexArray(mesh.getVaoId());</span>

    // Draw the object using its index buffer
<span class="nc" id="L75">    glDrawElements(GL_TRIANGLES, mesh.getVertexCount(), GL_UNSIGNED_INT, 0);</span>

    // Unbind the VAO for good practice
<span class="nc" id="L78">    glBindVertexArray(0);</span>
<span class="nc" id="L79">  }</span>

  @Override
  public void endScene() {
    // Unbind the shader program
<span class="nc" id="L84">    defaultShader.unbind();</span>
<span class="nc" id="L85">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>